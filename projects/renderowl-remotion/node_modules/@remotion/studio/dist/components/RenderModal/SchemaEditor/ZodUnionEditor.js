"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ZodUnionEditor = void 0;
const jsx_runtime_1 = require("react/jsx-runtime");
const ZodNonEditableValue_1 = require("./ZodNonEditableValue");
const ZodOrNullishEditor_1 = require("./ZodOrNullishEditor");
const zod_schema_type_1 = require("./zod-schema-type");
const findNull = (value) => {
    const nullIndex = value.findIndex((v) => {
        const type = (0, zod_schema_type_1.getZodSchemaType)(v);
        return type === 'null' || type === 'undefined';
    });
    if (nullIndex === -1) {
        return null;
    }
    const nullishValue = (0, zod_schema_type_1.getZodSchemaType)(value[nullIndex]) === 'null' ? null : undefined;
    const otherSchema = value[nullIndex === 0 ? 1 : 0];
    const otherType = (0, zod_schema_type_1.getZodSchemaType)(otherSchema);
    const otherSchemaIsAlsoNullish = otherType === 'null' || otherType === 'undefined';
    return {
        nullIndex,
        nullishValue,
        otherSchema,
        otherSchemaIsAlsoNullish,
    };
};
const ZodUnionEditor = ({ jsonPath, schema, setValue, onSave, defaultValue, value, showSaveButton, onRemove, saving, saveDisabledByParent, mayPad, }) => {
    const options = (0, zod_schema_type_1.getUnionOptions)(schema);
    if (options.length > 2) {
        return (jsx_runtime_1.jsx(ZodNonEditableValue_1.ZonNonEditableValue, { jsonPath: jsonPath, label: 'Union with more than 2 options not editable', showSaveButton: showSaveButton, saving: saving, mayPad: mayPad }));
    }
    if (options.length < 2) {
        return (jsx_runtime_1.jsx(ZodNonEditableValue_1.ZonNonEditableValue, { jsonPath: jsonPath, label: 'Union with less than 2 options not editable', showSaveButton: showSaveButton, saving: saving, mayPad: mayPad }));
    }
    const nullResult = findNull(options);
    if (!nullResult) {
        return (jsx_runtime_1.jsx(ZodNonEditableValue_1.ZonNonEditableValue, { jsonPath: jsonPath, label: 'Union only editable with 1 value being null', showSaveButton: showSaveButton, saving: saving, mayPad: mayPad }));
    }
    const { otherSchema, nullishValue, otherSchemaIsAlsoNullish } = nullResult;
    if (otherSchemaIsAlsoNullish) {
        return (jsx_runtime_1.jsx(ZodNonEditableValue_1.ZonNonEditableValue, { jsonPath: jsonPath, label: 'Not editable - both union values are nullish', showSaveButton: showSaveButton, saving: saving, mayPad: mayPad }));
    }
    return (jsx_runtime_1.jsx(ZodOrNullishEditor_1.ZodOrNullishEditor, { defaultValue: defaultValue, jsonPath: jsonPath, onRemove: onRemove, onSave: onSave, schema: schema, innerSchema: otherSchema, setValue: setValue, showSaveButton: showSaveButton, value: value, nullishValue: nullishValue, saving: saving, saveDisabledByParent: saveDisabledByParent, mayPad: mayPad }));
};
exports.ZodUnionEditor = ZodUnionEditor;
