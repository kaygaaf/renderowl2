{"version":3,"sources":["../../../../src/server/fs/middleware-location.ts"],"sourcesContent":["import { isNext16OrHigher } from '../../utils/sdk-versions';\nimport { nodeCwdOrThrow, nodeFsOrThrow, nodePathOrThrow } from './utils';\n\nfunction hasSrcAppDir() {\n  const { existsSync } = nodeFsOrThrow();\n  const path = nodePathOrThrow();\n  const cwd = nodeCwdOrThrow();\n\n  const projectWithAppSrc = path.join(cwd(), 'src', 'app');\n\n  return !!existsSync(projectWithAppSrc);\n}\n\nfunction suggestMiddlewareLocation() {\n  const fileExtensions = ['ts', 'js'] as const;\n  // Next.js 16+ supports both middleware.ts (Edge runtime) and proxy.ts (Node.js runtime)\n  const fileNames = isNext16OrHigher ? ['middleware', 'proxy'] : ['middleware'];\n  const fileNameDisplay = isNext16OrHigher ? 'middleware or proxy' : 'middleware';\n\n  const suggestionMessage = (\n    fileName: string,\n    extension: (typeof fileExtensions)[number],\n    to: 'src/' | '',\n    from: 'src/app/' | 'app/' | '',\n  ) =>\n    `Clerk: clerkMiddleware() was not run, your ${fileNameDisplay} file might be misplaced. Move your ${fileNameDisplay} file to ./${to}${fileName}.${extension}. Currently located at ./${from}${fileName}.${extension}`;\n\n  const { existsSync } = nodeFsOrThrow();\n  const path = nodePathOrThrow();\n  const cwd = nodeCwdOrThrow();\n\n  const projectWithAppSrcPath = path.join(cwd(), 'src', 'app');\n  const projectWithAppPath = path.join(cwd(), 'app');\n\n  const checkMiddlewareLocation = (\n    basePath: string,\n    to: 'src/' | '',\n    from: 'src/app/' | 'app/' | '',\n  ): string | undefined => {\n    for (const fileName of fileNames) {\n      for (const fileExtension of fileExtensions) {\n        if (existsSync(path.join(basePath, `${fileName}.${fileExtension}`))) {\n          return suggestionMessage(fileName, fileExtension, to, from);\n        }\n      }\n    }\n    return undefined;\n  };\n\n  if (existsSync(projectWithAppSrcPath)) {\n    return (\n      checkMiddlewareLocation(projectWithAppSrcPath, 'src/', 'src/app/') || checkMiddlewareLocation(cwd(), 'src/', '')\n    );\n  }\n\n  if (existsSync(projectWithAppPath)) {\n    return checkMiddlewareLocation(projectWithAppPath, '', 'app/');\n  }\n\n  return undefined;\n}\n\nexport { suggestMiddlewareLocation, hasSrcAppDir };\n"],"mappings":";AAAA,SAAS,wBAAwB;AACjC,SAAS,gBAAgB,eAAe,uBAAuB;AAE/D,SAAS,eAAe;AACtB,QAAM,EAAE,WAAW,IAAI,cAAc;AACrC,QAAM,OAAO,gBAAgB;AAC7B,QAAM,MAAM,eAAe;AAE3B,QAAM,oBAAoB,KAAK,KAAK,IAAI,GAAG,OAAO,KAAK;AAEvD,SAAO,CAAC,CAAC,WAAW,iBAAiB;AACvC;AAEA,SAAS,4BAA4B;AACnC,QAAM,iBAAiB,CAAC,MAAM,IAAI;AAElC,QAAM,YAAY,mBAAmB,CAAC,cAAc,OAAO,IAAI,CAAC,YAAY;AAC5E,QAAM,kBAAkB,mBAAmB,wBAAwB;AAEnE,QAAM,oBAAoB,CACxB,UACA,WACA,IACA,SAEA,8CAA8C,eAAe,uCAAuC,eAAe,cAAc,EAAE,GAAG,QAAQ,IAAI,SAAS,4BAA4B,IAAI,GAAG,QAAQ,IAAI,SAAS;AAErN,QAAM,EAAE,WAAW,IAAI,cAAc;AACrC,QAAM,OAAO,gBAAgB;AAC7B,QAAM,MAAM,eAAe;AAE3B,QAAM,wBAAwB,KAAK,KAAK,IAAI,GAAG,OAAO,KAAK;AAC3D,QAAM,qBAAqB,KAAK,KAAK,IAAI,GAAG,KAAK;AAEjD,QAAM,0BAA0B,CAC9B,UACA,IACA,SACuB;AACvB,eAAW,YAAY,WAAW;AAChC,iBAAW,iBAAiB,gBAAgB;AAC1C,YAAI,WAAW,KAAK,KAAK,UAAU,GAAG,QAAQ,IAAI,aAAa,EAAE,CAAC,GAAG;AACnE,iBAAO,kBAAkB,UAAU,eAAe,IAAI,IAAI;AAAA,QAC5D;AAAA,MACF;AAAA,IACF;AACA,WAAO;AAAA,EACT;AAEA,MAAI,WAAW,qBAAqB,GAAG;AACrC,WACE,wBAAwB,uBAAuB,QAAQ,UAAU,KAAK,wBAAwB,IAAI,GAAG,QAAQ,EAAE;AAAA,EAEnH;AAEA,MAAI,WAAW,kBAAkB,GAAG;AAClC,WAAO,wBAAwB,oBAAoB,IAAI,MAAM;AAAA,EAC/D;AAEA,SAAO;AACT;","names":[]}